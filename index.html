<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L√¨ X√¨ 2026 - Nh√¢n Ph·∫©m Ng≈© H√†nh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background: #7f1d1d; color: white; overflow-x: hidden; }
        
        /* Carousel: T·ªëi ∆∞u cho c·∫£ Mobile v√† PC */
        .carousel-container { 
            display: flex; 
            overflow-x: auto; 
            scroll-snap-type: x mandatory; 
            gap: 15px; 
            padding: 40px;
            scroll-behavior: smooth;
        }
        .carousel-container::-webkit-scrollbar { display: none; }
        
        .envelope-card {
            flex: 0 0 80%; /* M·∫∑c ƒë·ªãnh Mobile */
            scroll-snap-align: center; 
            aspect-ratio: 2/3.5;
            border-radius: 30px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4); 
            transition: all 0.3s ease;
            position: relative;
        }

        /* Fix giao di·ªán PC: Thu nh·ªè bao v√† cƒÉn gi·ªØa */
        @media (min-width: 768px) { 
            .envelope-card { flex: 0 0 200px; } 
            .carousel-container { justify-content: center; padding: 40px 0; }
        }

        /* ƒê·∫∑c tr∆∞ng Ng≈© H√†nh */
        .color-kim { background: radial-gradient(circle, #fff9c4, #fbc02d); color: #827717; border: 5px solid #fff; }
        .color-moc { background: radial-gradient(circle, #a5d6a7, #2e7d32); color: white; border: 5px solid #81c784; }
        .color-thuy { background: radial-gradient(circle, #90caf9, #1565c0); color: white; border: 5px solid #64b5f6; }
        .color-hoa { background: radial-gradient(circle, #ef9a9a, #c62828); color: white; border: 5px solid #e57373; }
        .color-tho { background: radial-gradient(circle, #bcaaa4, #4e342e); color: white; border: 5px solid #8d6e63; }

        .symbol { font-size: 4rem; margin-bottom: 1rem; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.2)); }
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        
        /* Hi·ªáu ·ª©ng tr∆∞·ª£t cho PC */
        @media (hover: hover) {
            .envelope-card:hover { transform: translateY(-15px); cursor: pointer; }
        }
    </style>
</head>
<body class="min-h-screen">

    <div id="setup-screen" class="max-w-md mx-auto p-6 mt-4">
        <div class="bg-white text-slate-900 rounded-[2.5rem] p-8 shadow-2xl border-b-8 border-yellow-500">
            <h2 class="text-3xl font-black text-red-700 text-center mb-2 uppercase italic">L√å X√å 2026</h2>
            <p class="text-center text-[10px] text-slate-400 mb-6 font-bold uppercase tracking-widest">Thi·∫øt l·∫≠p v√≠ ti·ªÅn c·ªßa "ƒê·∫°i Gia"</p>
            
            <div id="setup-list" class="space-y-2 mb-6 max-h-[40vh] overflow-y-auto pr-2"></div>

            <div class="bg-yellow-50 p-4 rounded-2xl mb-6 flex justify-between items-center border border-yellow-100 font-black text-red-600">
                <div class="text-center border-r border-yellow-200 pr-4 w-1/2">
                    <p class="text-[9px] uppercase text-yellow-600">T·ªïng t√∫i</p>
                    <p id="sum-count" class="text-xl">0</p>
                </div>
                <div class="text-center pl-4 w-1/2">
                    <p class="text-[9px] uppercase text-yellow-600">S√°t th∆∞∆°ng v√≠</p>
                    <p id="sum-money" class="text-xl">0ƒë</p>
                </div>
            </div>

            <button onclick="startGame()" class="w-full bg-red-600 text-white py-5 rounded-2xl font-black uppercase tracking-widest shadow-lg active:scale-95 transition-all">L√äN S√ÄN NGAY!</button>
        </div>
    </div>

    <div id="play-screen" class="hidden py-8">
        <div class="text-center mb-4 px-6">
            <h1 class="text-4xl font-black text-yellow-400 drop-shadow-md uppercase tracking-tighter italic">L√å X√å 2026</h1>
            <p id="progress-info" class="text-white/60 text-[10px] uppercase font-bold mt-1">ƒêang t√¨m ng∆∞·ªùi c√≥ nh√¢n ph·∫©m h·ªá "T√¢m Linh"...</p>
        </div>

        <div id="carousel" class="carousel-container mb-10"></div>

        <div class="px-6 text-center text-white/40 text-[10px] font-bold mb-8 uppercase tracking-widest">
            ‚Üê Vu·ªët sang ƒë·ªÉ t√¨m h·ªá ph√π h·ª£p ‚Üí
        </div>

        <div class="px-6 max-w-5xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-black/20 backdrop-blur-md p-5 rounded-3xl border border-white/5">
                    <h3 class="text-[10px] font-black text-yellow-500 uppercase mb-3 flex items-center">
                        <span class="mr-2">üí∞</span> T√¨nh h√¨nh kho l·ªôc
                    </h3>
                    <div id="stats-list" class="grid grid-cols-3 gap-2"></div>
                </div>
                <div class="bg-black/20 backdrop-blur-md p-5 rounded-3xl border border-white/5">
                    <h3 class="text-[10px] font-black text-yellow-500 uppercase mb-3 flex items-center">
                        <span class="mr-2">üìú</span> B·∫£ng v√†ng nh√¢n ph·∫©m
                    </h3>
                    <div id="history-list" class="space-y-2 max-h-40 overflow-y-auto pr-2 text-[10px]"></div>
                    <button onclick="resetGame()" class="mt-4 text-[8px] opacity-30 uppercase font-black underline hover:opacity-100">Reset cu·ªôc ƒë·ªùi</button>
                </div>
            </div>
        </div>
    </div>

    <div id="name-modal" class="hidden fixed inset-0 bg-black/90 backdrop-blur-xl flex items-center justify-center p-6 z-50">
        <div class="bg-white text-slate-900 p-8 rounded-[2.5rem] w-full max-w-xs text-center shadow-2xl animate-pop">
            <h3 class="font-black text-xl mb-4 text-red-600 uppercase italic">QU√ù DANH L√Ä G√å?</h3>
            <p class="text-[10px] text-slate-400 mb-6 font-bold uppercase">Khai th·∫≠t ƒë·ªÉ h·ªá th·ªëng c√≤n "ƒë·ªô"...</p>
            <input type="text" id="user-name" class="w-full bg-slate-100 p-5 rounded-2xl mb-4 text-center font-black text-xl outline-none focus:ring-4 focus:ring-red-200">
            <button onclick="confirmPick()" class="w-full bg-red-600 text-white py-5 rounded-2xl font-black uppercase shadow-xl active:scale-95 transition-all">M·ªû L·ªòC NGAY!</button>
        </div>
    </div>

    <div id="result-modal" class="hidden fixed inset-0 bg-red-900/95 backdrop-blur-2xl flex items-center justify-center p-6 z-[60]">
        <div class="bg-white w-full max-w-sm rounded-[3rem] p-10 text-center shadow-2xl border-8 border-yellow-400 animate-pop">
            <p id="wish-text" class="text-red-500 font-black text-[10px] uppercase mb-2 italic">L·ªúI CH√öC</p>
            <h3 id="res-user" class="text-3xl font-black text-slate-900 mb-6 uppercase tracking-tighter">USER</h3>
            <div class="bg-red-600 py-10 rounded-[2.5rem] shadow-inner mb-6">
                <span id="res-amount" class="text-5xl font-black text-yellow-400 tracking-tighter">0ƒë</span>
            </div>
            <button onclick="closeResult()" class="w-full bg-slate-900 text-white py-5 rounded-2xl font-black uppercase tracking-widest text-sm active:scale-90 transition-transform">XIN ƒêA T·∫†!</button>
        </div>
    </div>

    <script>
        const DENOMS = [500000, 200000, 100000, 50000, 20000, 10000, 5000, 2000, 1000];
        const ELEMENTS = [
            { name: 'KIM', color: 'color-kim', symbol: '‚ú®' },
            { name: 'M·ªòC', color: 'color-moc', symbol: 'üåø' },
            { name: 'TH·ª¶Y', color: 'color-thuy', symbol: 'üåä' },
            { name: 'H·ªéA', color: 'color-hoa', symbol: 'üî•' },
            { name: 'TH·ªî', color: 'color-tho', symbol: '‚õ∞Ô∏è' }
        ];
        const WISHES = [
            "Gi√†u sang b·∫•t th√¨nh l√¨nh!", "Nh√¢n ph·∫©m ƒë·ªânh c·ªßa ch√≥p!", "Ti·ªÅn v√†o nh∆∞ n∆∞·ªõc s√¥ng ƒê√†!", 
            "V·∫ª ƒë·∫πp kh√¥ng l·ªëi tho√°t!", "T√¨nh duy√™n ph∆°i ph·ªõi!", "V√≠ d√†y nh∆∞ b√°nh ch∆∞ng!", 
            "ƒê·∫πp trai nh·∫•t v√πng!", "Xinh g√°i nh·∫•t ph·ªë!", "NƒÉm nay l√†m ƒë·∫°i gia!"
        ];

        // Kh·ªüi t·∫°o √¢m thanh xu r∆°i
        const coinSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3');

        let state = JSON.parse(localStorage.getItem('lixi_2026_final')) || null;
        let pendingIdx = null;

        const setupList = document.getElementById('setup-list');
        DENOMS.forEach(v => {
            setupList.innerHTML += `
                <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <span class="font-black text-slate-700 text-sm">${v.toLocaleString()}ƒë</span>
                    <div class="flex items-center gap-3">
                        <button onclick="changeQty(${v}, -1)" class="w-8 h-8 bg-red-100 text-red-600 rounded-lg font-bold hover:bg-red-200">-</button>
                        <input type="number" id="input-${v}" value="0" class="w-10 text-center font-black bg-transparent text-sm outline-none">
                        <button onclick="changeQty(${v}, 1)" class="w-8 h-8 bg-red-100 text-red-600 rounded-lg font-bold hover:bg-red-200">+</button>
                    </div>
                </div>`;
        });

        function changeQty(v, d) {
            const i = document.getElementById(`input-${v}`);
            i.value = Math.max(0, parseInt(i.value) + d);
            updateSum();
        }

        function updateSum() {
            let tc = 0; let tm = 0;
            DENOMS.forEach(v => {
                let q = parseInt(document.getElementById(`input-${v}`).value) || 0;
                tc += q; tm += q * v;
            });
            document.getElementById('sum-count').innerText = tc;
            document.getElementById('sum-money').innerText = tm.toLocaleString() + 'ƒë';
        }

        function startGame() {
            let pkts = [];
            DENOMS.forEach(v => {
                let q = parseInt(document.getElementById(`input-${v}`).value) || 0;
                for(let n=0; n<q; n++) pkts.push(v);
            });
            if(pkts.length === 0) return alert("Vui l√≤ng nh·∫≠p √≠t nh·∫•t 1 bao l√¨ x√¨!");
            pkts.sort(() => Math.random() - 0.5);
            state = { pkts: pkts.map(v => ({ v, open: false, user: '' })), hist: [] };
            save();
        }

        function save() {
            localStorage.setItem('lixi_2026_final', JSON.stringify(state));
            render();
        }

        function render() {
            if (!state) return;
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('play-screen').classList.remove('hidden');

            const carousel = document.getElementById('carousel');
            const unopenIdxs = state.pkts.map((p, i) => p.open ? -1 : i).filter(i => i !== -1).slice(0, 5);
            
            if(unopenIdxs.length === 0) {
                carousel.innerHTML = `<div class="w-full text-center py-20 font-black text-yellow-400 uppercase tracking-widest">H·∫æT S·∫†CH L·ªòC R·ªíI! H·∫∏N NƒÇM SAU NH√â!</div>`;
            } else {
                carousel.innerHTML = unopenIdxs.map((realIdx, i) => {
                    const el = ELEMENTS[i % 5];
                    return `
                    <div onclick="openModal(${realIdx})" class="envelope-card ${el.color}">
                        <div class="symbol">${el.symbol}</div>
                        <span class="font-black text-lg uppercase tracking-widest">${el.name}</span>
                        <span class="text-[8px] font-bold mt-2 opacity-60 uppercase">Nh√¢n Ph·∫©m H·ªá ${el.name}</span>
                    </div>`;
                }).join('');
            }

            document.getElementById('progress-info').innerText = `C√≤n ${state.pkts.filter(p=>!p.open).length} t√∫i l·ªôc ƒëang ƒë·ª£i ch·ªß...`;

            const counts = {};
            state.pkts.filter(p => !p.open).forEach(p => counts[p.v] = (counts[p.v] || 0) + 1);
            document.getElementById('stats-list').innerHTML = DENOMS.filter(d => counts[d]).map(d => `
                <div class="bg-white/5 p-2 rounded-xl flex justify-between font-bold text-[9px]">
                    <span class="text-white/40">${d/1000}k</span>
                    <span class="text-yellow-400">${counts[d]}</span>
                </div>`).join('');

            document.getElementById('history-list').innerHTML = state.hist.slice().reverse().map(h => `
                <div class="flex justify-between border-b border-white/5 pb-1 mb-1 italic">
                    <span class="text-white/60">${h.user.toUpperCase()}</span>
                    <span class="text-yellow-500 font-black">+${h.v.toLocaleString()}ƒë</span>
                </div>`).join('');
        }

        function openModal(i) { pendingIdx = i; document.getElementById('name-modal').classList.remove('hidden'); document.getElementById('user-name').focus(); }
        function closeModal() { document.getElementById('name-modal').classList.add('hidden'); }

        function confirmPick() {
            const user = document.getElementById('user-name').value.trim();
            if(!user) return alert("Vui l√≤ng nh·∫≠p t√™n ƒë·ªÉ h·ªá th·ªëng c√≤n bi·∫øt ai m√† ƒë·ªô!");
            const p = state.pkts[pendingIdx];
            p.open = true; p.user = user;
            state.hist.push({ user, v: p.v });
            closeModal();
            showRes(user, p.v);
            save();
        }

        function showRes(user, v) {
            // Ph√°t √¢m thanh xu r∆°i
            coinSound.play().catch(() => console.log("C·∫ßn t∆∞∆°ng t√°c v·ªõi tr√¨nh duy·ªát tr∆∞·ªõc khi ph√°t √¢m thanh."));

            document.getElementById('res-user').innerText = user.toUpperCase();
            document.getElementById('res-amount').innerText = v.toLocaleString() + 'ƒë';
            document.getElementById('wish-text').innerText = WISHES[Math.floor(Math.random() * WISHES.length)];
            document.getElementById('result-modal').classList.remove('hidden');
            
            // Ph√°o hoa li√™n t·ª•c
            const end = Date.now() + 3000;
            (function f() {
                confetti({ particleCount: 10, angle: 60, spread: 55, origin: { x: 0 }, colors:['#ff0000','#ffd700'] });
                confetti({ particleCount: 10, angle: 120, spread: 55, origin: { x: 1 }, colors:['#ff0000','#ffd700'] });
                if(Date.now() < end) requestAnimationFrame(f);
            }());
        }

        function closeResult() { 
            document.getElementById('result-modal').classList.add('hidden'); 
            document.getElementById('user-name').value = '';
            document.getElementById('carousel').scrollLeft = 0; // Reset carousel v·ªã tr√≠ ƒë·∫ßu
        }
        
        function resetGame() { if(confirm("X√≥a to√†n b·ªô l·ªãch s·ª≠ v√† c√†i ƒë·∫∑t l·∫°i cu·ªôc ƒë·ªùi m·ªõi?")) { localStorage.removeItem('lixi_2026_final'); location.reload(); } }
        if(state) render();
    </script>
</body>
</html>
