<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L√¨ X√¨ Ch·ªß ƒê·ªông 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        .lucky-box { transition: all 0.2s; }
        .opened { background-color: #f1f5f9 !important; color: #cbd5e1 !important; cursor: not-allowed; border: 1px dashed #cbd5e1; box-shadow: none; }
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(75px, 1fr)); gap: 12px; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-800">

    <div id="setup-screen" class="max-w-md mx-auto bg-white min-h-screen md:min-h-fit md:my-10 p-6 md:rounded-3xl shadow-2xl">
        <div class="text-center mb-6">
            <span class="text-4xl">üßß</span>
            <h2 class="text-xl font-bold text-red-600 mt-2">THI·∫æT L·∫¨P T√öI L√å X√å</h2>
        </div>
        
        <div class="space-y-3" id="denomination-inputs">
            </div>

        <div class="mt-6 p-4 bg-red-50 rounded-2xl border border-red-100">
            <div class="flex justify-between items-center text-sm mb-1">
                <span class="text-slate-500">T·ªïng s·ªë bao:</span>
                <span id="display-total-count" class="font-bold text-slate-700">0 bao</span>
            </div>
            <div class="flex justify-between items-center">
                <span class="text-slate-500">T·ªïng ng√¢n s√°ch:</span>
                <span id="display-total-money" class="font-black text-red-600 text-lg">0ƒë</span>
            </div>
        </div>

        <button onclick="startGame()" class="w-full mt-6 bg-red-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-red-200 hover:bg-red-700 active:scale-95 transition-all">
            NI√äM PHONG & B·∫ÆT ƒê·∫¶U
        </button>
    </div>

    <div id="play-screen" class="hidden max-w-5xl mx-auto p-4">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-black text-red-600">L√å X√å 2026 üßß</h1>
            <button onclick="resetGame()" class="text-xs bg-white px-3 py-2 rounded-lg border shadow-sm">Reset Game</button>
        </div>

        <div class="flex flex-col lg:flex-row gap-6">
            <div class="flex-1">
                <div id="lucky-grid" class="grid-layout"></div>
            </div>

            <div class="w-full lg:w-80 space-y-6">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">C∆° h·ªôi c√≤n l·∫°i</h3>
                    <div id="stats-list" class="space-y-2"></div>
                </div>

                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">L·ªãch s·ª≠ r√∫t</h3>
                    <div id="history-list" class="space-y-3 max-h-60 overflow-y-auto"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="name-modal" class="hidden fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-6 z-50">
        <div class="bg-white p-8 rounded-3xl w-full max-w-xs shadow-2xl">
            <input type="text" id="user-name" placeholder="T√™n ng∆∞·ªùi b·ªëc..." class="w-full bg-slate-100 border-none p-4 rounded-xl mb-4 focus:ring-2 focus:ring-red-500 outline-none text-center font-bold">
            <button onclick="confirmPick()" class="w-full bg-red-600 text-white py-4 rounded-xl font-bold">M·ªû BAO</button>
            <button onclick="closeModal()" class="w-full mt-2 text-slate-400 text-xs py-2">Quay l·∫°i</button>
        </div>
    </div>

    <script>
        const DENOMS = [500000, 200000, 100000, 50000, 20000, 10000];
        let state = JSON.parse(localStorage.getItem('lixi_custom_2026')) || null;
        let pendingIdx = null;

        // Render giao di·ªán nh·∫≠p s·ªë l∆∞·ª£ng
        const inputContainer = document.getElementById('denomination-inputs');
        DENOMS.forEach(d => {
            const div = document.createElement('div');
            div.className = "flex items-center justify-between bg-slate-50 p-3 rounded-2xl border border-slate-100";
            div.innerHTML = `
                <span class="font-bold text-slate-600">${d.toLocaleString()}ƒë</span>
                <div class="flex items-center gap-3">
                    <input type="number" data-denom="${d}" value="0" min="0" oninput="updateCalculations()" 
                    class="denom-input w-20 text-center bg-white border border-slate-200 rounded-lg p-1 font-bold text-red-600 focus:outline-none focus:ring-1 focus:ring-red-500">
                    <span class="text-xs text-slate-400 w-8">bao</span>
                </div>
            `;
            inputContainer.appendChild(div);
        });

        function updateCalculations() {
            let totalMoney = 0;
            let totalCount = 0;
            document.querySelectorAll('.denom-input').forEach(input => {
                const count = parseInt(input.value) || 0;
                const val = parseInt(input.dataset.denom);
                totalMoney += count * val;
                totalCount += count;
            });
            document.getElementById('display-total-money').innerText = totalMoney.toLocaleString() + 'ƒë';
            document.getElementById('display-total-count').innerText = totalCount + ' bao';
        }

        function startGame() {
            let packets = [];
            document.querySelectorAll('.denom-input').forEach(input => {
                const count = parseInt(input.value) || 0;
                const val = parseInt(input.dataset.denom);
                for(let i = 0; i < count; i++) packets.push(val);
            });

            if (packets.length === 0) return alert("Vui l√≤ng nh·∫≠p √≠t nh·∫•t 1 bao l√¨ x√¨!");

            // X√°o tr·ªôn ng·∫´u nhi√™n
            packets.sort(() => Math.random() - 0.5);

            state = {
                packets: packets.map(v => ({ v, opened: false, user: '' })),
                history: []
            };
            save();
        }

        function save() {
            localStorage.setItem('lixi_custom_2026', JSON.stringify(state));
            render();
        }

        function render() {
            if (!state) return;
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('play-screen').classList.remove('hidden');

            const grid = document.getElementById('lucky-grid');
            grid.innerHTML = state.packets.map((p, i) => `
                <div onclick="openModal(${i})" class="lucky-box aspect-[3/4] rounded-xl flex items-center justify-center font-black text-lg shadow-sm cursor-pointer ${p.opened ? 'opened' : 'bg-red-500 text-white hover:bg-red-600'}">
                    ${p.opened ? `<span class="text-[10px] leading-tight text-center">${p.v.toLocaleString()}<br>ƒë</span>` : (i + 1)}
                </div>
            `).join('');

            // Th·ªëng k√™ c√≤n l·∫°i
            const remCounts = {};
            state.packets.filter(p => !p.opened).forEach(p => remCounts[p.v] = (remCounts[p.v] || 0) + 1);
            const stats = document.getElementById('stats-list');
            stats.innerHTML = DENOMS.filter(d => remCounts[d]).map(d => `
                <div class="flex justify-between text-sm py-1 border-b border-slate-50">
                    <span class="text-slate-500">${d.toLocaleString()}ƒë</span>
                    <span class="font-bold text-red-600">${remCounts[d]} bao</span>
                </div>
            `).join('');

            // L·ªãch s·ª≠
            const hist = document.getElementById('history-list');
            hist.innerHTML = state.history.slice().reverse().map(h => `
                <div class="bg-slate-50 p-3 rounded-xl flex justify-between items-center text-sm mb-2">
                    <span class="font-bold">${h.user}</span>
                    <span class="text-red-600 font-black">+${h.v.toLocaleString()}ƒë</span>
                </div>
            `).join('');
        }

        function openModal(i) {
            if (state.packets[i].opened) return;
            pendingIdx = i;
            document.getElementById('name-modal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('name-modal').classList.add('hidden'); }

        function confirmPick() {
            const user = document.getElementById('user-name').value.trim();
            if (!user) return alert("Nh·∫≠p t√™n b·∫°n nh√©!");

            const p = state.packets[pendingIdx];
            p.opened = true;
            p.user = user;
            state.history.push({ user, v: p.v });

            // B·∫Øn ph√°o hoa: To n·∫øu tr√∫ng >= 100k
            confetti({ 
                particleCount: p.v >= 100000 ? 150 : 50, 
                spread: 70, 
                origin: { y: 0.6 },
                colors: ['#ef4444', '#facc15', '#ffffff']
            });

            closeModal();
            document.getElementById('user-name').value = '';
            save();
        }

        function resetGame() {
            if (confirm("Reset s·∫Ω x√≥a to√†n b·ªô bao hi·ªán t·∫°i v√† l·ªãch s·ª≠. Ti·∫øp t·ª•c?")) {
                localStorage.removeItem('lixi_custom_2026');
                location.reload();
            }
        }

        if (state) render();
    </script>
</body>
</html>
